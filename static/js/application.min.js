requirejs.config({baseUrl:"",paths:{vendor:"static/assets/vendor",jquery:"static/assets/vendor/jquery","jquery-ui":"static/assets/vendor/jquery-ui.min",bootstrap:"static/assets/vendor/bootstrap.min",backbone:"static/assets/vendor/backbone-min",underscore:"static/assets/vendor/underscore-min",json2:"static/assets/vendor/json2",paper:"static/assets/vendor/paper",io:"static/assets/vendor/socket.io.min"},shim:{"jquery-ui":{exports:"$",deps:["jquery"]},bootstrap:{exports:"$",deps:["jquery"]},underscore:{exports:"_"},backbone:{deps:["jquery","underscore","json2"],exports:"Backbone"},paper:{exports:"paper"},io:{exports:"io"}}}),define(["jquery","backbone","app"],function(a,b,c){function d(b){var c=null;if(document.cookie&&""!==document.cookie)for(var d=document.cookie.split(";"),e=0;e<d.length;e++){var f=a.trim(d[e]);if(f.substring(0,b.length+1)===b+"="){c=decodeURIComponent(f.substring(b.length+1));break}}return c}return b._sync=b.sync,b.sync=function(a,c,e){if("create"==a||"update"==a||"delete"==a||"post"==a||"get"==a){var f=d("csrftoken");e.beforeSend=function(a){a.setRequestHeader("X-CSRFToken",f)}}return b._sync(a,c,e)},c.initialize(),console.log("jQuery version: ",a.fn.jquery),a(function(){console.log("Backbone: ",b.VERSION)}),{}}),define("app",["jquery","app/views/main","app/views/board","app/views/canvas","app/boardconnection","app/boardmessagehandler","app/toolbar","app/utils","app/models/board","bootstrap"],function(a,b,c,d,e,f,g,h){var i=function(){function d(){var a=h.getBoardId(),d=new f;j=new e(a,d),k=new c({boardConnection:j}),d.setBoardView(k);var g=new b({boardView:k,boardId:a});g.render()}function i(){var b=new g;b.addTool(a("#eraser_tool").tool(b,{action:function(){a("#board").css("cursor","url(/static/images/eraser_disabled.ico),default"),k.selectEraserTool()}})),b.addTool(a("#postit_tool").tool(b,{action:function(){a("#board").css("cursor","url(/static/images/postit_disabled.ico),default"),k.selectPostitTool()}})),b.addTool(a("#pencil_black_tool").tool(b,{action:function(){}})),b.addTool(a("#pencil_black_tool").tool(b,{action:function(){a("#board").css("cursor","url(/static/images/pencil_disabled.ico),default"),k.selectPencilTool("black")}})),b.addTool(a("#pencil_green_tool").tool(b,{action:function(){a("#board").css("cursor","url(/static/images/pencil_green_disabled.ico),default"),k.selectPencilTool("green"),a("#pencil_black_tool").addClass("tool_enabled")}})),b.addTool(a("#pencil_red_tool").tool(b,{action:function(){a("#board").css("cursor","url(/static/images/pencil_red_disabled.ico),default"),k.selectPencilTool("red"),a("#pencil_black_tool").addClass("tool_enabled")}})),b.addTool(a("#pencil_blue_tool").tool(b,{action:function(){a("#board").css("cursor","url(/static/images/pencil_blue_disabled.ico),default"),k.selectPencilTool("blue"),a("#pencil_black_tool").addClass("tool_enabled")}})),b.addTool(a("#clear_lines_tool").tool(b,{action:function(){k.clearLines()},confirmable:!0,exclusive:!1})),b.addTool(a("#rectline_tool").tool(b,{action:function(){a("#board").css("cursor","crosshair"),k.selectRectLineTool("FF000000")}})),b.addTool(a("#text_tool").tool(b,{action:function(){a("#board").css("cursor","crosshair"),k.selectTextTool()}}))}var j,k;a(document).ready(function(){d(),i();var b=a("#pencil_tools");b.mouseover(function(){a("#pencil_green_tool").fadeIn("fast"),a("#pencil_red_tool").fadeIn("fast"),a("#pencil_blue_tool").fadeIn("fast")}),b.mouseleave(function(){a("#pencil_green_tool").fadeOut("fast"),a("#pencil_red_tool").fadeOut("fast"),a("#pencil_blue_tool").fadeOut("fast")}),a(window).bind("beforeunload",function(){j.disconnect()})})};return{initialize:i}}),define("app/boardconnection",["jquery","io","app/models/userprofile"],function(a,b,c){"use strict";function d(d,e){this.ws=b.connect("http://"+window.ws_host);var f=this;f.user=new c,this.ws.on("connect",function(){f.user.fetch({success:function(b){if(b.get("user"))f.user=b.get("user");else{var c=Math.floor(1e3*Math.random()+1);f.user={id:c,username:"guess"+c}}f.subscribe(d,f.user),f.ws.on("message",function(b){e.handle(a.parseJSON(b))})}})})}return d.prototype.disconnect=function(){this.ws.disconnect()},d.prototype.send=function(a,b){b.channel_id||(b.channel_id=this.board_id,b.user=this.user),this.ws.send(JSON.stringify({type:a,args:b}))},d.prototype.movePostit=function(a,b,c){this.send("move",{obj:"postit",id:a,x:b,y:c})},d.prototype.moveText=function(a,b,c){this.send("move",{obj:"text",id:a,x:b,y:c})},d.prototype.resizePostit=function(a,b,c){this.send("resize",{obj:"postit",id:a,w:b,h:c})},d.prototype.resizeText=function(a,b,c){this.send("resize",{obj:"text",id:a,w:b,h:c})},d.prototype.updatePostitText=function(a,b){this.send("update",{obj:"postit",id:a,text:b})},d.prototype.updateText=function(a,b){this.send("update",{obj:"text",id:a,text:b})},d.prototype.changePostitColor=function(a,b,c){this.send("change_color",{id:a,color:b,back_color:c})},d.prototype.subscribe=function(a,b){this.board_id=a,this.send("register",{user:b})},d.prototype.newPostit=function(a,b,c,d,e,f){this.send("new",{obj:"postit",id:a,x:b,y:c,w:d,h:e,text:f})},d.prototype.newText=function(a,b,c,d,e,f){this.send("new",{obj:"text",id:a,x:b,y:c,w:d,h:e,text:f})},d.prototype.deletePostit=function(a){this.send("delete",{obj:"postit",id:a})},d.prototype.deleteText=function(a){this.send("delete",{obj:"text",id:a})},d.prototype.deleteLine=function(a){this.send("delete",{obj:"line",id:a})},d.prototype.startPath=function(a,b,c,d){this.send("startPath",{id:a,x:b,y:c,color:d})},d.prototype.addPathPoint=function(a,b,c){this.send("addPathPoint",{id:a,x:b,y:c})},d.prototype.finishPath=function(a){this.send("finishPath",{id:a})},d}),define("app/boardmessagehandler",["jquery"],function(a){var b=function(){var b;this.boardView=null;var c=this;this.handlers={startPath:function(a){c.boardView.startPath(a.id,a.x,a.y,a.color)},addPathPoint:function(a){c.boardView.addPathPoint(a.id,a.x,a.y)},finishPath:function(a){c.boardView.finishPath(a.id)},"new":function(a){"postit"===a.obj?c.boardView.showPostit(a.id):"text"===a.obj&&c.boardView.showText(a.id)},update:function(a){"postit"===a.obj?c.boardView.updatePostitText(a.id,a.text):"text"===a.obj&&c.boardView.updateText(a.id,a.text)},move:function(a){"postit"===a.obj?c.boardView.movePostit(a.id,a.x,a.y):"text"===a.obj&&c.boardView.moveText(a.id,a.x,a.y)},resize:function(a){"postit"===a.obj?c.boardView.resizePostit(a.id,a.w,a.h):"text"===a.obj&&c.boardView.resizeText(a.id,a.w,a.h)},"delete":function(a){"postit"===a.obj?c.boardView.deletePostit(a.id):"line"===a.obj?c.boardView.deleteLine(a.id):"text"===a.obj&&c.boardView.deleteText(a.id)},change_color:function(a){c.boardView.changePostitColor(a.id,a.back_color)},info:function(c){b=c.connected_users+1,a("#connected_users").text(b);for(var d in c.users){var e=c.users[d];a("#online_users").append("guess"===e.username.substring(0,5)?'<a href="#" id="user_'+e.username+"_"+e.id+'">'+e.username+"</a><br/>":'<a href="/accounts/'+e.username+'" id="user_'+e.username+"_"+e.id+'" target="_blank">'+e.username+"</a><br/>")}},register:function(c){b++,a("#connected_users").text(b),a("<div/>").addClass("user_connected").appendTo(a("#notifications")).text(c.user.username+" has joined!").show("slow").hide(4e3,function(){a(this).remove()}),a("#online_users").append("guess"===c.user.username.substring(0,5)?'<a href="#" id="user_'+c.user.username+"_"+c.user.id+'">'+c.user.username+"</a><br/>":'<a href="/accounts/'+c.user.username+'" id="user_'+c.user.username+"_"+c.user.id+'" target="_blank">'+c.user.username+"</a><br/>")},disconnect:function(c){b--,a("#connected_users").text(b),a("<div/>").addClass("user_disconnected").appendTo(a("#notifications")).text(c.username+" has left!").show("slow").hide(4e3,function(){a(this).remove()}),a("#user_"+c.username+"_"+c.id).hide(2e3,function(){a(this).next().remove(),a(this).remove()})}}};return b.prototype.handle=function(a){var b=a.type;this.handlers[b]&&this.handlers[b](a.args)},b.prototype.setBoardView=function(a){this.boardView=a},b}),define("app/collections/lines",["backbone","app/models/line","app/utils"],function(a,b,c){var d=c.getBoardId(),e=a.Collection.extend({model:b,url:"api/boards/"+d+"/lines/"});return e}),define("app/collections/postits",["backbone","app/models/postit","app/utils"],function(a,b,c){var d=c.getBoardId(),e=a.Collection.extend({model:b,url:"api/boards/"+d+"/postits/"});return e}),define("app/collections/texts",["backbone","app/models/text","app/utils"],function(a,b,c){var d=c.getBoardId(),e=a.Collection.extend({model:b,url:"api/boards/"+d+"/texts/"});return e}),define("app/models/board",["backbone"],function(a){var b=a.Model.extend({urlRoot:"api/boards/"});return b}),define("app/models/line",["backbone","app/utils"],function(a,b){var c=b.getBoardId(),d=a.Model.extend({urlRoot:"api/boards/"+c+"/lines/",initialize:function(){this.zoom=1},setZoom:function(a){this.zoom=a,this.trigger("change:zoom")}});return d}),define("app/models/postit",["backbone","app/utils"],function(a,b){var c=b.getBoardId(),d=a.Model.extend({urlRoot:"api/boards/"+c+"/postits/",initialize:function(){this.zoom=1},setZoom:function(a){this.zoom=a,this.trigger("change:zoom")}});return d}),define("app/models/text",["backbone","app/utils"],function(a,b){var c=b.getBoardId(),d=a.Model.extend({urlRoot:"api/boards/"+c+"/texts/",initialize:function(){this.zoom=1},setZoom:function(a){this.zoom=a,this.trigger("change:zoom")}});return d}),define("app/models/userprofile",["backbone"],function(a){var b=a.Model.extend({urlRoot:"api/profile/"});return b}),define("app/toolbar",["jquery"],function(){var a=function(){this.tools=[]};return a.prototype.addTool=function(a){this.tools.push(a)},function(a){a.fn.tool=function(b,c){var d=a.extend({element:this,exclusive:!0},c);return this.click(function(){d.exclusive&&a.each(b.tools,function(a,b){b.element.removeClass("tool_enabled")}),a(this).addClass("tool_enabled"),d.confirmable?a("#dialog").dialog({buttons:{Confirm:function(){a(this).dialog("close"),d.action()},Cancel:function(){a(this).dialog("close")}}}):d.action()}),d}}(jQuery),a}),define("app/utils",["backbone","app/models/userprofile"],function(){function a(){var a=window.location.pathname.replace(/^\/([^\/]*).*$/,"$1");return a?a:""}return{getBoardId:a}}),define("app/views/board",["jquery","backbone","app/views/postit","app/views/canvas","app/views/text","app/models/board","app/models/postit","app/models/text","app/collections/postits","app/collections/texts"],function(a,b,c,d,e,f,g,h,i,j){var k=b.View.extend({el:a("#board"),events:{"mousedown #board-canvas":"mousedown",mousemove:"mouseMove",mouseup:"mouseUp","click #zoom_in":"zoomIn","click #zoom_out":"zoomOut","click #connected_users_btn":"toggleUsers"},initialize:function(b){this.boardConnection=b.boardConnection,this.zoom=1,this.tool="postits",this.canvas=new d({boardConnection:this.boardConnection,zoom:this.zoom}),this.canvas.render(),this.postits=new i,this.postits.bind("add",this.addOne,this),this.postits.bind("reset",this.addAll,this),this.postits.bind("all",this.render,this),this.postits.fetch(),this.texts=new j,this.texts.bind("add",this.addOneText,this),this.texts.bind("reset",this.addAllTexts,this),this.texts.bind("all",this.render,this),this.texts.fetch(),a("#connected_users_btn").popover({container:"#online_users"})},mousedown:function(b){"drawing"===this.tool&&this.canvas.startLine(b.pageX,b.pageY,"free"),"rectDrawing"===this.tool&&this.canvas.startLine(b.pageX,b.pageY,"rect"),"eraser"===this.tool&&this.canvas.tryToErase(b.pageX,b.pageY);var c=this;if("postits"===this.tool){var d=new g({x:Math.round(b.pageX/c.zoom),y:Math.round(b.pageY/c.zoom),width:120,height:120,text:""});d.setZoom(c.zoom),this.postits.add(d),d.save(null,{success:function(a){c.boardConnection.newPostit(a.get("id"),d.get("x"),d.get("y"),d.get("width"),d.get("height"),d.get("text"))}}),d.trigger("focus")}if("text"===this.tool){var f=new h({text:"",x:Math.round(b.pageX/c.zoom),y:Math.round(b.pageY/c.zoom),width:150,height:50});f.setZoom(c.zoom),this.texts.add(f);var i=new e({model:f,boardConnection:this.boardConnection,zoom:c.zoom});a("#board").append(i.render().el),f.save(null,{success:function(a){c.boardConnection.newText(a.get("id"),f.get("x"),f.get("y"),f.get("width"),f.get("height"),f.get("text"))}})}return!1},mouseMove:function(a){("drawing"===this.tool||"rectDrawing"===this.tool)&&this.canvas.mouseMove(a)},mouseUp:function(a){("drawing"===this.tool||"rectDrawing"===this.tool)&&this.canvas.finishLine(a)},showPostit:function(a){var b=new g({id:a});b.fetch(),b.setZoom(this.zoom),this.postits.add(b)},showText:function(a){var b=this,c=new h({id:a});c.setZoom(this.zoom),c.fetch({success:function(){b.texts.add(c)}})},addAll:function(){this.postits.each(this.addOne,this)},addAllTexts:function(){this.texts.each(this.addOneText,this)},addOne:function(b){var d=new c({model:b,boardConnection:this.boardConnection,zoom:this.zoom});a("#board").append(d.render().el)},addOneText:function(b){var c=new e({model:b,boardConnection:this.boardConnection,zoom:this.zoom});a("#board").append(c.render().el)},movePostit:function(a,b,c){this.postits.get(a).set({x:b,y:c})},moveText:function(a,b,c){this.texts.get(a).set({x:b,y:c})},resizePostit:function(a,b,c){this.postits.get(a).set({width:b,height:c})},resizeText:function(a,b,c){this.texts.get(a).set({width:b,height:c})},changePostitColor:function(a,b){this.postits.get(a).set("back_color",b)},deletePostit:function(a){this.postits.remove(a)},deleteText:function(a){this.texts.remove(a)},updatePostitText:function(a,b){this.postits.get(a).set("text",b)},updateText:function(a,b){this.texts.get(a).set("text",b)},startPath:function(a,b,c,d){this.canvas.startPath(a,b,c,d)},addPathPoint:function(a,b,c){this.canvas.addPathPoint(a,b,c)},finishPath:function(a){this.canvas.finishPath(a)},selectPostitTool:function(){this.tool="postits"},selectPencilTool:function(a){this.tool="drawing",this.canvas.setStrokeColor(a)},selectRectLineTool:function(){this.tool="rectDrawing",this.canvas.setStrokeColor("black")},selectEraserTool:function(){this.tool="eraser"},selectTextTool:function(){this.tool="text"},clearLines:function(){this.canvas.clearLines()},deleteLine:function(a){this.canvas.deleteLine(a)},zoomIn:function(b){b.preventDefault(),this.zoom<2&&(this.zoom+=.1);var c=this;this.postits.each(function(a){a.setZoom(c.zoom)}),this.texts.each(function(a){a.setZoom(c.zoom)}),this.canvas.setZoom(this.zoom),a("#zoom_value").text(Math.round(100*this.zoom)+"%"),this.render()},zoomOut:function(b){b.preventDefault(),this.zoom>.25&&(this.zoom-=.1);var c=this;this.postits.each(function(a){a.setZoom(c.zoom)}),this.texts.each(function(a){a.setZoom(c.zoom)}),this.canvas.setZoom(this.zoom),a("#zoom_value").text(Math.round(100*this.zoom)+"%"),this.render()},render:function(){a("#board").css("height",1500*this.zoom).css("width",3e3*this.zoom),a("#board-canvas").css("height",1500*this.zoom).css("width",3e3*this.zoom).height(1500*this.zoom).width(3e3*this.zoom)},toggleUsers:function(b){b.preventDefault(),a("#online_users_container").toggle("slow")}});return k}),define("app/views/canvas",["jquery","backbone","underscore","paper","app/models/line","app/collections/lines"],function(a,b,c,d,e,f){var g=b.View.extend({el:a("#board-canvas"),lines:new f,initialize:function(a){this.boardConnection=a.boardConnection,this.zoom=a.zoom,this.strokeColor="black";var b=this,e=this.el;d.setup(e),d.view.viewSize=new d.Size(3e3*this.zoom,1500*this.zoom),d.view.draw(),this.lines.fetch({success:function(a){c.each(a.models,function(a){a.get("path")&&(a.path=b.drawLinePath(a),a.path.model=a),a.bind("change:zoom",b.render,b),d.view.draw()})}})},render:function(){d.view.draw()},startLine:function(a,b,c){var f=new e;f.set("color_l",this.strokeColor),f.type=c,this.shadowPath=new d.Path,this.shadowPath.strokeColor=this.strokeColor,this.shadowPath.dashArray=[10,12];var g=new d.Path;g.model=f,g.strokeColor=this.strokeColor;var h=new d.Point(a,b);g.add(h),this.shadowPath.add(h);var i=this;f.save({stroke_w:1},{success:function(c){i.line=c,i.line.path=g,i.lines.add(c),i.boardConnection.startPath(c.get("id"),a/i.zoom,b/i.zoom,c.get("color_l")),d.view.draw()}})},mouseMove:function(a){var b=this;setTimeout(function(){b.line&&1===a.which&&("free"===b.line.type?(b.line.path.add(new d.Point(a.pageX,a.pageY)),b.boardConnection.addPathPoint(b.line.get("id"),a.pageX/b.zoom,a.pageY/b.zoom)):(b.shadowPath.removeSegment(1),b.shadowPath.add(new d.Point(a.pageX,a.pageY)))),d.view.draw()},0)},finishLine:function(a){this.line&&("rect"===this.line.type?(this.shadowPath.remove(),this.line.path.add(new d.Point(a.pageX,a.pageY)),this.boardConnection.addPathPoint(this.line.get("id"),a.pageX/this.zoom,a.pageY/this.zoom)):this.line.path.simplify(10),d.view.draw(),this.boardConnection.finishPath(this.line.get("id")),this.line.save({path:this.serialize(this.line.path)}),this.lines.add(this.line),this.line=null)},serialize:function(b){var c=[],d=this;return a.each(b.getSegments(),function(a,b){var e={point:{x:b.getPoint().x/d.zoom,y:b.getPoint().y/d.zoom},handleIn:{x:b.getHandleIn().x/d.zoom,y:b.getHandleIn().y/d.zoom},handleOut:{x:b.getHandleOut().x/d.zoom,y:b.getHandleOut().y/d.zoom}};c.push(e)}),JSON.stringify(c)},drawLinePath:function(b){var c=this,e=new d.Path;return e.strokeColor=b.get("color_l"),a.each(a.parseJSON(b.get("path")),function(a,b){b.point.x=b.point.x*c.zoom,b.point.y=b.point.y*c.zoom,b.handleIn.x=b.handleIn.x*c.zoom,b.handleOut.y=b.handleOut.y*c.zoom,e.add(new d.Segment(b.point,b.handleIn,b._handleOut))}),e},startPath:function(a,b,c){var f=new e({id:a}),g=new d.Path;g.add(new d.Point(b*this.zoom,c*this.zoom)),f.path=g,f.path.model=f,f.fetch({success:function(a){g.strokeColor=a.get("color_l")}}),this.lines.add(f)},addPathPoint:function(a,b,c){this.lines.get(a).path.add(new d.Point(b*this.zoom,c*this.zoom)),d.view.draw()},finishPath:function(a){var b=this;this.lines.get(a).path.simplify(10),this.lines.get(a).fetch({success:function(a){a.path.remove(),a.path=b.drawLinePath(a),d.view.draw()}})},setStrokeColor:function(a){this.strokeColor=a},clearLines:function(){var a=this;c.chain(this.lines.models).clone().each(function(b){b.path&&b.path.remove(),b.destroy(),a.boardConnection.deleteLine(b.get("id"))}),d.view.draw()},tryToErase:function(a,b){var c={segments:!0,stroke:!0,fill:!0,tolerance:5},e=d.project.hitTest(new d.Point(a,b),c);e&&(e.item.remove(),this.boardConnection.deleteLine(e.item.model.get("id")),e.item.model.destroy(),d.view.draw())},deleteLine:function(a){var b=this.lines.get(a);b&&b.path&&(b.path.remove(),d.view.draw())},setZoom:function(b){var e=this;this.zoom=b,c.each(this.lines.models,function(b){if(b.path){var c=b.path.getSegments();b.get("path")&&a.each(a.parseJSON(b.get("path")),function(a,b){var d=c[a];if(d){var f=d.getPoint(),g=d.getHandleIn(),h=d.getHandleOut();f.x=b.point.x*e.zoom,f.y=b.point.y*e.zoom,g.x=b.handleIn.x*e.zoom,g.y=b.handleIn.y*e.zoom,h.x=b.handleOut.x*e.zoom,h.y=b.handleOut.y*e.zoom}})}}),d.view.viewSize=new d.Size(3e3*this.zoom,1500*this.zoom),d.view.draw()}});return g}),define("app/views/main",["jquery","backbone","app/views/postit","app/views/canvas","app/models/board","app/models/postit","app/collections/postits"],function(a,b,c,d,e){var f=b.View.extend({el:a("body"),events:{"mouseover #menu_tool":"showMenu","mouseleave #menu_tool":"leaveMenuTool","mouseleave #menu":"leaveMenu","mouseenter #menu":"enteredMenu","click #set-password":"showSetPasswordModal","click #set-alias":"showSetAliasModal","click #set-password-btn":"setBoardPassword","click #set-alias-btn":"setBoardAlias"},initialize:function(b){this.boardView=b.boardView;var c=b.boardId;this.board=new e({id:c}),this.menu=a("#menu"),this.menu.menu(),a("#set-password-modal").modal({show:!1}),a("#set-alias-modal").modal({show:!1})},render:function(){var a=this;this.board.fetch({success:function(){a.boardView.render()}})},showMenu:function(){clearTimeout(this.menu.data("timeoutId")),this.menu.show()},leaveMenu:function(){this.menu.fadeOut("fast")},enteredMenu:function(){clearTimeout(this.menu.data("timeoutId"))},leaveMenuTool:function(){var a=this.menu,b=setTimeout(function(){a.fadeOut("fast")},200);this.menu.data("timeoutId",b)},showSetPasswordModal:function(b){b.preventDefault(),a("#set-password-modal").modal("show")},showSetAliasModal:function(b){b.preventDefault(),a("board-alias").val(this.board.get("hash")),a("#set-alias-modal").modal("show")},setBoardPassword:function(b){b.preventDefault(),a("#set-password-btn").attr("disabled","disabled");var c=a("#board-password"),d=a("#board-password2"),e=c.val(),f=d.val();e===f?(this.board.set("password",e),this.board.save({},{success:function(){a("#set-password-modal").modal("hide"),a("#set-password-btn").removeAttr("disabled"),c.val(""),a("set-password-error").hide()}})):(a("#set-password-error").fadeIn(),a(this).removeAttr("disabled"))},setBoardAlias:function(b){b.preventDefault(),a("#set-alias-btn").attr("disabled","disabled");var c=a("#board-alias").val();/[^a-zA-Z0-9]/.test(c)?(a("#set-alias-error").fadeOut().fadeIn(),a("#set-alias-btn").removeAttr("disabled")):(this.board.set("hash",c),this.board.save({},{success:function(){a("#set-alias-modal").modal("hide"),a("#set-alias-btn").removeAttr("disabled"),a("set-alias-error").hide(),window.location.href="/"+c},error:function(b,c){var d=a.parseJSON(c.responseText);a("#set-alias-error-msg").html(d.hash?d.hash[0]:"There was an unknown error. Try again."),a("#set-alias-btn").removeAttr("disabled"),a("#set-alias-error").fadeOut().fadeIn()}}))}});return f}),define("app/views/postit",["jquery-ui","backbone"],function(a,b){var c=b.View.extend({tagName:"div",events:{mouseover:"showToolbar",mouseout:"hideToolbar","click .postit_close_image":"deletePostit","mouseover .postit_color_image":"showColors","keyup .postit_input":"updateText"},initialize:function(b){this.boardConnection=b.boardConnection,this.zoom=b.zoom,this.model.bind("change",this.render,this),this.model.bind("destroy",this.doRemove,this),this.model.bind("remove",this.doRemove,this),this.model.bind("focus",this.focus,this),this.model.bind("change:zoom",this.render,this);var c=this;this.$el.attr("id","postit"+this.model.id).addClass("postit").css("position","absolute").css("top",this.model.get("y")+"px").css("left",this.model.get("x")+"px").css("width",this.model.get("width")+"px").css("height",this.model.get("height")+"px").css("padding","22px 2px 2px 2px").css("background-color",this.model.get("back_color")).draggable({stack:".postit",cursor:"move",containment:"parent",drag:function(){var b=a(this).position();c.boardConnection.movePostit(c.model.get("id"),b.left/c.model.zoom,b.top/c.model.zoom)},stop:function(){var b=a(this).position();c.model.save({x:Math.round(b.left/c.model.zoom),y:Math.round(b.top/c.model.zoom)})}}).resizable({resize:function(){var b=a(this).width(),d=a(this).height();c.boardConnection.resizePostit(c.model.get("id"),b/c.model.zoom,d/c.model.zoom)},stop:function(a,b){var d=b.size.width,e=b.size.height;c.model.save({width:Math.round(d/c.model.zoom),height:Math.round(e/c.model.zoom)})}}),this.createPostitCloseElement().appendTo(this.$el),this.createPostitColorTool().appendTo(this.$el),this.createPostitTextArea().appendTo(this.$el),this.createChangePostitColorTool().appendTo(this.$el),this.input=this.$(".postit_input"),this.$el.fadeIn("fast")},focus:function(){this.input.focus()},render:function(){return this.$el.css("top",this.model.get("y")*this.model.zoom+"px").css("left",this.model.get("x")*this.model.zoom+"px").css("width",this.model.get("width")*this.model.zoom+"px").css("height",this.model.get("height")*this.model.zoom+"px").css("background-color",this.model.get("back_color")),this.input.css("background-color",this.model.get("back_color")).css("font-size",12*this.model.zoom+"px"),this.input.val(this.model.get("text")),this},createPostitCloseElement:function(){return a("<img/>").addClass("postit_close_image").attr("src","/static/images/close.png")},deletePostit:function(){this.model.destroy(),this.boardConnection.deletePostit(this.model.get("id"))},createPostitTextArea:function(){var b=a("<textarea/>").addClass("postit_input").css("background-color",this.model.get("back_color"));return b.val(this.model.get("text")),b},updateText:function(){var a=this.input.val();this.model.save({text:a},{silent:!0}),this.boardConnection.updatePostitText(this.model.get("id"),a)},createPostitColorTool:function(){var b=a("<img/>").addClass("postit_color_image").attr("src","/static/images/colors.png");return b},showColors:function(){this.$el.find(".postit_color_tool").show()},createChangePostitColorTool:function(){var b=a("<div />").addClass("postit_color_tool");return b.mouseleave(function(){b.fadeOut("fast")}),this.createColorSelectionElement("#FFFF33","left").appendTo(b),this.createColorSelectionElement("#FF69B4","right").appendTo(b),this.createColorSelectionElement("#ADFF2F","left").appendTo(b),this.createColorSelectionElement("gold","right").appendTo(b),b.hide()},createColorSelectionElement:function(b,c){var d=this;return a("<div class='postit_color'/>").css("background-color",b).css("float",c).click(function(){d.model.save({back_color:b}),d.boardConnection.changePostitColor(d.model.get("id"),b,b)})},showToolbar:function(){this.$el.find(".postit_close_image").show(),this.$el.find(".postit_color_image").show(),this.$el.css("padding-top","2px"),this.$el.css("padding-bottom","20px")},hideToolbar:function(){this.$el.find(".postit_close_image").hide(),this.$el.find(".postit_color_image").hide(),this.$el.css("padding-top","22px"),this.$el.css("padding-bottom","2px")},doRemove:function(){this.$el.fadeOut("fast",function(){this.remove()})}});return c}),define("app/views/text",["jquery-ui","backbone"],function(a,b){var c=b.View.extend({tagName:"div",events:{mouseover:"showToolbar",mouseout:"hideToolbar","click .postit_close_image":"deleteText","keyup .text_input":"updateText"},initialize:function(b){this.boardConnection=b.boardConnection,this.zoom=b.zoom,this.model.bind("change",this.render,this),this.model.bind("remove",this.remove,this),this.model.bind("change:zoom",this.render,this);var c=this;this.$el.attr("id","text"+this.model.id).addClass("text"),this.$el.css("top",this.model.get("y")+"px").css("position","absolute").css("left",this.model.get("x")+"px").css("padding","22px 2px 2px 2px").css("width",this.model.get("width")+"px").css("height",this.model.get("height")+"px"),this.$el.draggable({cursor:"move",containment:"parent",drag:function(){var b=a(this).position();c.boardConnection.moveText(c.model.get("id"),b.left/c.model.zoom,b.top/c.model.zoom)},stop:function(){var b=a(this).position();c.model.save({x:Math.round(b.left/c.model.zoom),y:Math.round(b.top/c.model.zoom)})}}).resizable({autoHide:!0,resize:function(){var b=a(this).width(),d=a(this).height();c.boardConnection.resizeText(c.model.get("id"),b/c.model.zoom,d/c.model.zoom)},stop:function(a,b){var d=b.size.width,e=b.size.height;c.model.save({width:Math.round(d/c.model.zoom),height:Math.round(e/c.model.zoom)})}}),this.createCloseElement().appendTo(this.$el),this.createTextArea().appendTo(this.$el),this.input=this.$(".text_input")},render:function(){return this.$el.css("top",this.model.get("y")*this.model.zoom+"px").css("left",this.model.get("x")*this.model.zoom+"px").css("width",this.model.get("width")*this.model.zoom+"px").css("height",this.model.get("height")*this.model.zoom+"px"),this.input.val(this.model.get("text")).css("font-size",12*this.model.zoom+"px"),this},createCloseElement:function(){return a("<img/>").addClass("postit_close_image").attr("src","/static/images/close.png")},createTextArea:function(){var b=a("<textarea/>").addClass("text_input");return b.val(this.model.get("text")),b.attr("placeholder","Write your text"),b},showToolbar:function(){this.$el.find(".postit_close_image").show(),this.$el.css("padding-top","2px"),this.$el.css("padding-bottom","20px")},hideToolbar:function(){this.$el.find(".postit_close_image").hide(),this.$el.css("padding-top","22px"),this.$el.css("padding-bottom","2px")},updateText:function(){var a=this.input.val(),b=this;this.model.save({text:a},{silent:!0,success:function(){b.boardConnection.updateText(b.model.get("id"),a)}})},deleteText:function(){this.remove(),this.model.destroy(),this.boardConnection.deleteText(this.model.get("id"))}});return c});